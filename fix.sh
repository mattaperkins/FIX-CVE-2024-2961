#!/bin/bash
# Program to detect CVE-2024-2961 and Mitigate 
# Matt Perkins 24-4-2024 

# Check for GLIBC 

# Path to iconv
ICONVPATH='/usr/lib/x86_64-linux-gnu/gconv'

if [ -d $ICONVPATH ]; then
	echo "$ICONVPATH found. "
	else
	echo "$ICONVPATH not found please edit."
	exit
fi



CHECKGLIBC=`ldd --version | grep GLIBC`
SUB="GLIBC" 

if [[ "$CHECKGLIBC" =~ .*"$SUB".* ]]; then
	echo  Checking for $SUB - $CHECKGLIBC Found. 
	else 
	echo  Checking for $SUB - $CHECKGLIBC not found. 
	echo Nothing to display. 
fi

# Check for spcific Chinese Fonts 
CHECKICONV=`iconv -l | grep -E 'CN-?EXT'`
SUB="EXT"
echo -n Checking for fonts . 

if [[ "$CHECKICONV" =~ .*"$SUB".* ]]; then
	echo $CHECKICONV found. 
	else 
	echo not found. 
	echo nothing to do. 
	exit
fi


grep -v -E 'CN-?EXT' <$ICONVPATH/gconv-modules.d/gconv-modules-extra.conf >$ICONVPATH/gconv-modules.d/gconv-modules-extra.conf.new
mv -f $ICONVPATH/gconv-modules.d/gconv-modules-extra.conf.new $ICONVPATH/gconv-modules.d/gconv-modules-extra.conf
iconvconfig 
echo Where all done if your it doubt run it agian. 
